{% extends "base.html" %}
{% block content %}
<div class="hero" style="position: relative; overflow: hidden; background: #007aff; color: white; padding: 100px 20px; text-align: center;">
    <div id="canvas-parent"></div>
    
    <div class="container">
        <h1 style="font-size: 3rem; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">Voyagez ensemble Ã  Lechelle</h1>
        <p style="font-size: 1.2rem; opacity: 0.9;">Le covoiturage solidaire, gratuit et sans frais.</p>
    </div>
</div>

<div class="container" style="margin-top: -40px;">
    {% if current_user.is_authenticated %}
    <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 40px;">
        <h3 style="margin-top:0;">Proposer un trajet</h3>
        <form action="/publish" method="post" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
            <input name="departure" placeholder="DÃ©part" required style="padding:12px; border-radius:8px; border:1px solid #ddd;">
            <input name="destination" placeholder="Destination" required style="padding:12px; border-radius:8px; border:1px solid #ddd;">
            <input type="date" name="date" required style="padding:12px; border-radius:8px; border:1px solid #ddd;">
            <input type="time" name="time" required style="padding:12px; border-radius:8px; border:1px solid #ddd;">
            <input type="number" name="seats" placeholder="Places" min="1" required style="padding:12px; border-radius:8px; border:1px solid #ddd;">
            <input name="contact" placeholder="TÃ©l" required style="padding:12px; border-radius:8px; border:1px solid #ddd;">
            <button type="submit" class="btn btn-primary">Publier</button>
        </form>
    </div>
    {% endif %}

    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px;">
        {% for r in rides %}
        <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
            <div id="map_{{ r.id }}" style="height:160px;" data-dep="{{ r.departure }}" data-dest="{{ r.destination }}"></div>
            <div style="padding:20px;">
                <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">{{ r.departure }} âž” {{ r.destination }}</div>
                <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 15px;">
                    ðŸ“… {{ r.date|date_french }} Ã  {{ r.time }}<br>
                    ðŸ‘¤ Par {{ r.driver_name }}
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:600; color:var(--accent);">ðŸ’º {{ r.seats }} places</span>
                    <a href="/reserve/{{ r.id }}" class="btn btn-primary" style="padding:8px 20px; font-size:0.9rem;">RÃ©server</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    let particles = [];

    function setup() {
        let canvas = createCanvas(windowWidth, 350); // Match hero height
        canvas.parent('canvas-parent');
        for (let i = 0; i < 50; i++) {
            particles.push(new Particle());
        }
    }

    function draw() {
        clear(); // Keep background transparent to see the CSS gradient
        particles.forEach(p => {
            p.update();
            p.draw();
            p.connect(particles);
        });
    }

    class Particle {
        constructor() {
            this.pos = createVector(random(width), random(height));
            this.vel = createVector(random(-0.5, 0.5), random(-0.5, 0.5));
            this.size = 4;
        }
        update() {
            this.pos.add(this.vel);
            if (this.pos.x > width || this.pos.x < 0) this.vel.x *= -1;
            if (this.pos.y > height || this.pos.y < 0) this.vel.y *= -1;
        }
        draw() {
            noStroke();
            fill('rgba(255, 255, 255, 0.5)');
            circle(this.pos.x, this.pos.y, this.size);
        }
        connect(others) {
            others.forEach(other => {
                let d = dist(this.pos.x, this.pos.y, other.pos.x, other.pos.y);
                if (d < 100) {
                    stroke(`rgba(255, 255, 255, ${map(d, 0, 100, 0.2, 0)})`);
                    line(this.pos.x, this.pos.y, other.pos.x, other.pos.y);
                }
            });
        }
    }

    function windowResized() {
        resizeCanvas(windowWidth, 350);
    }
</script>
{% endblock %}