<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Co-Voiturage</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css">
    <style>
        /* Glass-like UI */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255,255,255,0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 min-h-screen flex flex-col items-center p-6">

    <h1 class="text-white text-3xl font-bold mb-6">Co-Voiturage</h1>

    <div class="glass p-6 w-full max-w-lg mb-6">
        <h2 class="text-white text-xl mb-4">Ajouter un trajet</h2>
        <form id="rideForm" class="flex flex-col gap-3">
            <input type="text" placeholder="De" id="from" class="p-2 rounded">
            <input type="text" placeholder="À" id="to" class="p-2 rounded">
            <input type="date" id="date" class="p-2 rounded">
            <input type="time" id="time" class="p-2 rounded">
            <input type="number" placeholder="Places" id="seats" class="p-2 rounded">
            <button type="submit" class="bg-white text-black p-2 rounded font-bold">Ajouter</button>
        </form>
    </div>

    <div class="glass p-6 w-full max-w-lg">
        <h2 class="text-white text-xl mb-4">Trajets</h2>
        <div id="ridesContainer" class="flex flex-col gap-3">
            <!-- Rides will appear here -->
        </div>
    </div>

    <script>
        const ADMIN_KEY = prompt("Enter admin key (leave blank if not admin)");

        async function fetchRides() {
            const res = await fetch('/get_rides');
            const rides = await res.json();
            const container = document.getElementById('ridesContainer');
            container.innerHTML = '';
            rides.forEach(r => {
                const div = document.createElement('div');
                div.className = 'bg-white/10 p-3 rounded flex justify-between items-center';
                div.innerHTML = `
                    <div>
                        <strong>${r.from}</strong> → <strong>${r.to}</strong><br>
                        ${r.date} ${r.time} | Places: ${r.seats}
                    </div>
                    <button class="bg-red-500 text-white p-1 rounded" onclick="deleteRide(${r.id})">Supprimer</button>
                `;
                container.appendChild(div);
            });
        }

        async function deleteRide(id) {
            const res = await fetch('/delete_ride', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id, admin_key: ADMIN_KEY})
            });
            const data = await res.json();
            if (data.status === 'deleted_by_admin') {
                alert('Ride deleted by admin');
                fetchRides();
            } else {
                alert('Unauthorized');
            }
        }

        document.getElementById('rideForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const ride = {
                from: document.getElementById('from').value,
                to: document.getElementById('to').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                seats: document.getElementById('seats').value
            };
            await fetch('/add_ride', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(ride)
            });
            fetchRides();
        });

        fetchRides();
        setInterval(fetchRides, 10000); // refresh every 10s
    </script>
</body>
</html>
