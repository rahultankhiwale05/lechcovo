<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Lechelle Covoit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --glass: rgba(255, 255, 255, 0.95); --accent: #007aff; --bg: #f5f5f7; }
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background: var(--bg); }
        
        /* New Hero Section */
        .hero { 
            background: linear-gradient(rgba(0,122,255,0.8), rgba(0,122,255,0.6)), url('/static/carte-postale-ancienne-lechelle-20_0.jpg') center/cover;
            color: white; padding: 60px 20px; text-align: center; margin-bottom: 40px;
        }
        .hero h1 { margin: 0; font-size: 2.5em; }
        .hero p { font-size: 1.2em; opacity: 0.9; }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .nav { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 25px; border-radius: 0 0 15px 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 0; }
        
        /* Empty State Styling */
        .empty-state { text-align: center; padding: 80px 20px; background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .empty-state h2 { color: #333; }
        .empty-state p { color: #666; margin-bottom: 25px; }

        .ride-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; padding-bottom: 40px; }
        .card { background: white; border-radius: 18px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: 0.3s; }
        .btn { border: none; padding: 12px 25px; border-radius: 10px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-outline { border: 2px solid var(--accent); color: var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <div class="nav">
        <strong>ðŸš— Lechelle Covoit</strong>
        <div>
            {% if current_user.is_authenticated %}
                <span>Bonjour, {{ current_user.name }}</span> | <a href="/logout">DÃ©connexion</a>
            {% else %}
                <a href="/login">Connexion</a> | <a href="/signup">Inscription</a>
            {% endif %}
        </div>
    </div>
</div>

<div class="hero">
    <h1>Voyagez ensemble</h1>
    <p>Le moyen le plus simple et Ã©cologique pour vos trajets quotidiens.</p>
    {% if not current_user.is_authenticated %}
        <div style="margin-top: 20px;">
            <a href="/signup" class="btn" style="background:white; color:var(--accent);">Commencer maintenant</a>
        </div>
    {% endif %}
</div>

<div class="container">
    {% with messages = get_flashed_messages() %}{% if messages %}
        {% for m in messages %}<div style="background:var(--accent); color:white; padding:15px; border-radius:10px; margin-bottom:20px;">{{ m }}</div>{% endfor %}
    {% endif %}{% endwith %}

    {% if current_user.is_authenticated %}
    <div style="background:white; padding:25px; border-radius:18px; margin-bottom:40px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
        <h3>Proposer un trajet</h3>
        <form action="/publish" method="post" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px;">
            <input name="departure" placeholder="Ville de dÃ©part" required style="padding:12px; border-radius:10px; border:1px solid #ddd;">
            <input name="destination" placeholder="Destination" required style="padding:12px; border-radius:10px; border:1px solid #ddd;">
            <input name="contact" placeholder="TÃ©l" required style="padding:12px; border-radius:10px; border:1px solid #ddd;">
            <input type="date" name="date" required style="padding:12px; border-radius:10px; border:1px solid #ddd;">
            <input type="time" name="time" required style="padding:12px; border-radius:10px; border:1px solid #ddd;">
            <input type="number" name="seats" placeholder="Places" min="1" required style="padding:12px; border-radius:10px; border:1px solid #ddd;">
            <button type="submit" class="btn btn-primary">Publier</button>
        </form>
    </div>
    {% endif %}

    {% if rides %}
        <div class="ride-grid">
            {% for r in rides %}
            <div class="card">
                <div id="map_{{ r.id }}" style="height:150px; background:#eee;" data-dep="{{ r.departure }}" data-dest="{{ r.destination }}"></div>
                <div style="padding:15px;">
                    <strong>{{ r.departure }} âž” {{ r.destination }}</strong>
                    <p style="font-size:0.9em; color:#666;">ðŸ“… {{ r.date }} Ã  {{ r.time }}</p>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span>Places: {{ r.seats }}</span>
                        {% if current_user.is_authenticated %}
                            <a href="{{ url_for('reserve', ride_id=r.id) }}" class="btn btn-primary" style="padding:8px 15px; font-size:0.9em;">RÃ©server</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h2>Aucun trajet disponible</h2>
            <p>Il n'y a pas encore de trajets prÃ©vus. Soyez le premier Ã  en proposer un ou revenez plus tard !</p>
            {% if current_user.is_authenticated %}
                <p>ðŸ’¡ Remplissez le formulaire ci-dessus pour commencer.</p>
            {% else %}
                <a href="/login" class="btn btn-outline">Connectez-vous pour publier</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Leaflet map logic remains the same...
</script>
</body>
</html>